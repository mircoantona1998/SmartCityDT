# Node 22 LTS, base leggera
FROM node:22-alpine

WORKDIR /app

# Copio solo package*.json per cache build; se non li hai, vedi nota sotto
COPY package*.json ./

# Installa dipendenze runtime (senza dev)
RUN npm ci --omit=dev || npm i --omit=dev

# Copia lo script principale
COPY simulator.js ./simulator.js

# Imposto timezone utile per i log locali
RUN apk add --no-cache tzdata ca-certificates && \
    ln -snf /usr/share/zoneinfo/Europe/Rome /etc/localtime && echo "Europe/Rome" > /etc/timezone

ENV NODE_ENV=production \
    TZ=Europe/Rome

# I JSON li monteremo da docker-compose (bind mount), cos√¨ li cambi senza rebuild
CMD ["node", "simulator.js"]
